<!DOCTYPE html>
<html>
<head>
	<title>World Map for Digital Nomads</title>
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<script src="bower_components/datamaps/src/js/components/d3/d3.min.js"></script>
	<script src="bower_components/datamaps/src/js/components/topojson/topojson.js"></script>
	<script src="bower_components/datamaps/dist/datamaps.world.min.js"></script>
    <script src="bower_components/jquery/dist/jquery.js"></script>
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet" href="bower_components/bootstrap-select/dist/css/bootstrap-select.css">
    <script src="bower_components/bootstrap-select/dist/js/bootstrap-select.js"></script>


</head>

<body>
<div class="container-fluid">
    <div class="row" id="map-row">
        <div class="col-md-offset-2 col-md-10" id="map-cotainer">
            <div id="map"></div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6 col-lg-offset-4">
            <div id="command">
                <label for="picker" id="picker-label">Choose display criteria</label>
                <select class="form-control" id="picker" onchange="getData(this.value)">
                    <option value="nomadScore">Nomad Score</option>
                    <option value="nightlife">Night life</option>
                    <option value="life_score">Life Score</option>
                    <option value="places_to_work">Places to work</option>
                    <option value="press_freedom_index">Press freedom index</option>
                </select>
            </div>
        </div>
    </div>



</div>

<script>

    var colors = d3.scale.linear().domain([0, 1])
        .interpolate(d3.interpolateHcl)
        .range([d3.rgb("#36FFF7"), d3.rgb('#0009FF')]);

    var map = null

    function getData(param) { // ex. nomadScore
        $.getJSON("http://localhost:8080/", function (data) {
            var dataPoints = data[param];
            var filles = {};
            for(var i in dataPoints) {
                var help = dataPoints[i];
                filles[i] = colors(help);
                dataPoints[i] = {
                    fillKey: i,
                    dataP: help,
                    desc: param
                };
            }
//            var keys = [];
//            for(var k in scores) keys.push(k);
            changeColors(filles, dataPoints)

        });
    }

    function changeColors(filles, dataPoints) {
//        $("#map").html("");
        if (map == null){
            map = new Datamap({element: document.getElementById('map'), projection: 'mercator',
                geographyConfig: {
                    popupTemplate: function (geo, data) {
                        return ['<div class="hoverinfo"><strong>',
                            'The ' + data.desc + " of " + geo.properties.name,
                            ' is ' + data.dataP,
                            '</strong></div>'].join('');
                    },
                    popupOnHover: true, //disable the popup while hovering
                    highlightOnHover: false,
                },
                fills: filles,
                data: dataPoints,

            });
        } else {
            map.data = dataPoints;
            map.updateChoropleth(filles);
        }

    }

    getData('nomadScore')

</script>
</body>
</html>