<!DOCTYPE html>
<html>
<head>
	<title>World Map for Digital Nomads</title>
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<script src="bower_components/datamaps/src/js/components/d3/d3.min.js"></script>
	<script src="bower_components/datamaps/src/js/components/topojson/topojson.js"></script>
    <script src="bower_components/datamaps/dist/datamaps.world.js"></script>
    <script src="bower_components/jquery/dist/jquery.js"></script>
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.css">

    <!--<link rel="stylesheet" href="bower_components/bootstrap-select/dist/css/bootstrap-select.css">-->
    <!--<script src="bower_components/bootstrap-select/dist/js/bootstrap-select.js"></script>-->


</head>

<body>
<div class="container-fluid">

    <div class="row" id="title_bar">
        <div class="col-md-6 col-lg-offset-4">
            <h2>Visualizing digital nomads</h2>
        </div>
    </div>

    <div class="row" id="map-row">
        <div class="col-md-offset-2 col-md-10" id="map-cotainer">
            <div id="map"></div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6 col-lg-offset-4">
            <div id="command">
                <div class="form-group col-md-8">
                    <h2 id="picker-label">Choose display criteria:</h2>
                    <!--<label class="col-md-offset-4" for="picker">Choose display criteria</label>-->
                    <select class="form-control" id="picker" onchange="getData(this.value)">
                        <option class="option-center" value="nomadScore">Nomad Score</option>
                        <option class="option-center" value="nightlife">Night life</option>
                        <option class="option-center" value="life_score">Life Score</option>
                        <option class="option-center" value="places_to_work">Places to work</option>
                        <option class="option-center" value="press_freedom_index">Press freedom index</option>
                        <option class="option-center" value="aircon">Air conditioning</option>
                        <option class="option-center" value="free_wifi_available">Free WIFI available</option>
                        <option class="option-center" value="friendly_to_foreigners">Friendliness to foreigners</option>
                        <option class="option-center" value="female_friendly">Female friendly</option>
                        <option class="option-center" value="racism">Racism</option>
                        <option class="option-center" value="safety">Safety</option>
                        <option class="option-center" value="lgbt_friendly">LGBT Friendly</option>
                        <option class="option-center" value="fragile_states_index">Fragile States Index</option>
                        <option class="option-center" value="freedom_score">Freedom Score</option>
                        <option class="option-center" value="leisure">Leisure</option>
                        <option class="option-center" value="peace_score">Peace Score</option>
                        <option class="option-center" value="nomad">Expences for Nomads</option>
                        <option class="option-center" value="expat">Expences for Expats</option>
                        <option class="option-center" value="longTerm">Expences - Long Term</option>
                        <option class="option-center" value="shortTerm">Expences - Short Term</option>
                        <option class="option-center" value="local">Expences for Locals</option>
                    </select>
                </div>
            </div>
        </div>
    </div>



</div>

<script>
    function getBetterName(name){
        if(name == "nomadScore") return "Nomad score";
        if(name == "nightlife") return "Night life";
        if(name == "life_score") return "Life score";
        if(name == "places_to_work") return "Places to work";
        if(name == "press_freedom_index") return "Press freedom index";
        if(name == "aircon") return "Air conditioning";
        if(name == "free_wifi_available") return "Free WIFI available";
        if(name == "friendly_to_foreigners") return "Friendliness to foreigners";
        if(name == "female_friendly") return "Female friendly";
        if(name == "racism") return "Racism";
        if(name == "safety") return "Safety";
        if(name == "lgbt_friendly") return "LGBT Friendly";
        if(name == "fragile_states_index") return "Fragile States Index";
        if(name == "freedom_score") return "Freedom Score";
        if(name == "leisure") return "Leisure";
        if(name == "peace_score") return "Peace Score";
        if(name == "nomad") return "Expences for Nomads";
        if(name == "expat") return "Expences for Expats";
        if(name == "longTerm") return "Expences - Long Term";
        if(name == "shortTerm") return "Expences - Short Term";
        if(name == "local") return "Expences for Locals";

    }

    var colors = d3.scale.linear().domain([0, 1])
        .interpolate(d3.interpolateHcl)
        .range([d3.rgb("#36FFF7"), d3.rgb('#0009A6')]);

    var colors2 = d3.scale.linear().domain([0, 2500])
        .interpolate(d3.interpolateHcl)
        .range([d3.rgb("#36FFF7"), d3.rgb('#0009A6')]);

    var colors3 = d3.scale.linear().domain([0, 82])
        .interpolate(d3.interpolateHcl)
        .range([d3.rgb("#36FFF7"), d3.rgb('#0009A6')]);

    var colors4 = d3.scale.linear().domain([0, 82])
        .interpolate(d3.interpolateHcl)
        .range([d3.rgb("#36FFF7"), d3.rgb('#0009A6')]);

    var map = null;

    function getData(param) { // ex. nomadScore
        $.getJSON("http://localhost:8080/2", function (data) {
            var dataPoints = data[param];
            for(var i in dataPoints) {
                var help = dataPoints[i];
                if(param == "shortTerm" || param == "longTerm" || param == "expat"|| param == "nomad"){
                    dataPoints[i] = {
                        color: colors2(help),
                        dataP: help,
                        desc: param
                    };
                } else if (param == "press_freedom_index"){
                    dataPoints[i] = {
                        color: colors3(help),
                        dataP: help,
                        desc: param
                    }
                } else if (param == "fragile_states_index"){
                    dataPoints[i] = {
                        color: colors4(help),
                        dataP: help,
                        desc: param
                    }
                }else {
                    dataPoints[i] = {
                        color: colors(help),
                        dataP: help,
                        desc: param
                    };
                }

            }
            changeColors(dataPoints)

        });
    }

    function changeColors(dataPoints) {
//        $("#map").html("");
        if (map == null){
            map = new Datamap({element: document.getElementById('map'), projection: 'mercator',
                geographyConfig: {
                    popupTemplate: function (geo, data) {
                        if(data == null){
                            return ['<div class="hoverinfo"><strong>',
                                geo.properties.name + ': no data',
                                '</strong></div>'].join('');
                        }
                        return ['<div class="hoverinfo"><strong>',
                            'The ' + getBetterName(data.desc) + " of " + geo.properties.name,
                            ' is ' + data.dataP,
                            '</strong></div>'].join('');
                    },
                    popupOnHover: true, //disable the popup while hovering
                    highlightOnHover: false,
                },
                fills: {
                    defaultFill : 'black'
                },
                data: dataPoints

            });
            map.updateChoropleth(dataPoints, {reset: false});
        } else {
            map.updateChoropleth(dataPoints, {reset: false});
        }

    }

    getData('nomadScore')

</script>
</body>
</html>