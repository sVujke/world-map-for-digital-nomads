<!DOCTYPE html>
<html>
<head>
	<title>World Map for Digital Nomads</title>
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<script src="bower_components/datamaps/src/js/components/d3/d3.min.js"></script>
	<script src="bower_components/datamaps/src/js/components/topojson/topojson.js"></script>
	<script src="bower_components/datamaps/dist/datamaps.world.min.js"></script>
    <script src="bower_components/jquery/dist/jquery.js"></script>
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.css">
    <!--<link rel="stylesheet" href="bower_components/bootstrap-select/dist/css/bootstrap-select.css">-->
    <!--<script src="bower_components/bootstrap-select/dist/js/bootstrap-select.js"></script>-->


</head>

<body>
<div class="container-fluid">
    <div class="row" id="map-row">
        <div class="col-md-offset-2 col-md-10" id="map-cotainer">
            <div id="map"></div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6 col-lg-offset-4">
            <div id="command">
                <div class="form-group col-md-8">
                    <h2 id="picker-label">Choose display criteria:</h2>
                    <!--<label class="col-md-offset-4" for="picker">Choose display criteria</label>-->
                    <select class="form-control" id="picker" onchange="getData(this.value)">
                        <option class="option-center" value="nomadScore">Nomad Score</option>
                        <option class="option-center" value="nightlife">Night life</option>
                        <option class="option-center" value="life_score">Life Score</option>
                        <option class="option-center" value="places_to_work">Places to work</option>
                        <option class="option-center" value="press_freedom_index">Press freedom index</option>
                        <option class="option-center" value="aircon">Air conditioning</option>
                        <option class="option-center" value="free_wifi_available">Free WIFI available</option>
                        <option class="option-center" value="friendly_to_foreigners">Friendliness to foreigners</option>
                        <option class="option-center" value="female_friendly">Female friendly</option>
                        <option class="option-center" value="racism">Racism</option>
                        <option class="option-center" value="safety">Safety</option>
                        <option class="option-center" value="lgbt_friendly">LGBT Friendly</option>
                        <option class="option-center" value="fragile_states_index">Fragile States Index</option>
                        <option class="option-center" value="freedom_score">Freedom Score</option>
                        <option class="option-center" value="leisure">Leisure</option>
                        <option class="option-center" value="peace_score">Peace Score</option>
                        <option class="option-center" value="nomad">Expences for Nomads</option>
                        <option class="option-center" value="expat">Expences for Expats</option>
                        <option class="option-center" value="longTerm">Expences - Long Term</option>
                        <option class="option-center" value="shortTerm">Expences - Short Term</option>
                        <option class="option-center" value="local">Expences for Locals</option>
                    </select>
                </div>
            </div>
        </div>
    </div>



</div>

<script>

    var colors = d3.scale.linear().domain([0, 1])
        .interpolate(d3.interpolateHcl)
        .range([d3.rgb("#36FFF7"), d3.rgb('#0009FF')]);

    var map = null;

    function getData(param) { // ex. nomadScore
        $.getJSON("http://localhost:8080/", function (data) {
            var dataPoints = data[param];
            for(var i in dataPoints) {
                var help = dataPoints[i];
                dataPoints[i] = {
                    color: colors(help),
                    dataP: help,
                    desc: param
                };
            }
            changeColors(dataPoints)

        });
    }

    function changeColors(dataPoints) {
//        $("#map").html("");
        if (map == null){
            map = new Datamap({element: document.getElementById('map'), projection: 'mercator',
                geographyConfig: {
                    popupTemplate: function (geo, data) {
                        if(data == null){
                            return ['<div class="hoverinfo"><strong>',
                                'No data',
                                '</strong></div>'].join('');
                        }
                        return ['<div class="hoverinfo"><strong>',
                            'The ' + data.desc + " of " + geo.properties.name,
                            ' is ' + data.dataP,
                            '</strong></div>'].join('');
                    },
                    popupOnHover: true, //disable the popup while hovering
                    highlightOnHover: false,
                },
                fills: {
                    defaultFill : 'black'
                },
                data: dataPoints

            });
            map.updateChoropleth(dataPoints, {reset: false});
        } else {
            map.updateChoropleth(dataPoints, {reset: false});
        }

    }

    getData('nomadScore')

</script>
</body>
</html>